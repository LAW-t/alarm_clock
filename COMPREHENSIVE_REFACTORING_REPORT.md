# é—¹é’Ÿé¡¹ç›®å…¨é¢é‡æ„å’Œä¼˜åŒ–æŠ¥å‘Š

## ğŸ“‹ é‡æ„æ¦‚è¿°

æœ¬æ¬¡é‡æ„å¯¹é—¹é’Ÿé¡¹ç›®è¿›è¡Œäº†å…¨é¢çš„ä»£ç è´¨é‡æå‡ã€æ€§èƒ½ä¼˜åŒ–ã€é”™è¯¯å¤„ç†å¢å¼ºå’Œå¯ç»´æŠ¤æ€§æ”¹è¿›ã€‚é‡æ„éµå¾ªäº†ç°ä»£Androidå¼€å‘æœ€ä½³å®è·µï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€å¯æµ‹è¯•æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ¯ é‡æ„ç›®æ ‡

### ä»£ç è´¨é‡æå‡
- âœ… è§£å†³ç»„ä»¶è¿‡å¤§é—®é¢˜ï¼ˆAlarmsScreen.ktä»752è¡Œæ‹†åˆ†ä¸ºå¤šä¸ªå°ç»„ä»¶ï¼‰
- âœ… æ¶ˆé™¤ç¡¬ç¼–ç å€¼ï¼Œé›†ä¸­ç®¡ç†å¸¸é‡
- âœ… æé«˜ä»£ç å¤ç”¨æ€§å’Œæ¨¡å—åŒ–
- âœ… ç»Ÿä¸€å‘½åè§„èŒƒå’Œä»£ç é£æ ¼

### æ¶æ„ä¼˜åŒ–
- âœ… å¼•å…¥Clean Architectureçš„UseCaseå±‚
- âœ… å¢å¼ºRepositoryå±‚åŠŸèƒ½
- âœ… ä¼˜åŒ–ViewModelèŒè´£åˆ†ç¦»
- âœ… æ”¹è¿›ä¾èµ–æ³¨å…¥é…ç½®

### æ€§èƒ½ä¼˜åŒ–
- âœ… ç§»é™¤AlarmSchedulerä¸­çš„runBlockingè°ƒç”¨
- âœ… æ·»åŠ é€‚å½“çš„è®°å¿†åŒ–ä¼˜åŒ–
- âœ… ä¼˜åŒ–æ•°æ®æµå’ŒçŠ¶æ€ç®¡ç†
- âœ… æ”¹è¿›å¼‚æ­¥æ“ä½œå¤„ç†

### é”™è¯¯å¤„ç†å¢å¼º
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ï¼ˆResultå°è£…ç±»ï¼‰
- âœ… æ·»åŠ è¾“å…¥éªŒè¯å’Œè¾¹ç•Œæƒ…å†µå¤„ç†
- âœ… æ”¹è¿›ç”¨æˆ·é”™è¯¯åé¦ˆ
- âœ… è§„èŒƒåŒ–æ—¥å¿—è®°å½•

### æµ‹è¯•è¦†ç›–
- âœ… æ·»åŠ UseCaseå•å…ƒæµ‹è¯•
- âœ… æ·»åŠ ViewModelå•å…ƒæµ‹è¯•
- âœ… æé«˜ä»£ç å¯æµ‹è¯•æ€§

## ğŸ—ï¸ æ¶æ„æ”¹è¿›

### æ–°å¢å±‚æ¬¡ç»“æ„

```
app/src/main/java/com/example/alarm_clock_2/
â”œâ”€â”€ util/
â”‚   â”œâ”€â”€ Constants.kt                    # ç»Ÿä¸€å¸¸é‡ç®¡ç†
â”‚   â””â”€â”€ Result.kt                       # ç»Ÿä¸€ç»“æœå°è£…
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â””â”€â”€ AlarmDisplayItem.kt         # UIæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ AlarmRepository.kt              # å¢å¼ºçš„Repository
â”‚   â””â”€â”€ AlarmDao.kt                     # å¢å¼ºçš„DAO
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ usecase/
â”‚       â”œâ”€â”€ AlarmUseCase.kt             # é—¹é’Ÿä¸šåŠ¡é€»è¾‘
â”‚       â””â”€â”€ AlarmScheduleUseCase.kt     # è°ƒåº¦ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ AlarmCard.kt                # é—¹é’Ÿå¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ EmptyState.kt               # ç©ºçŠ¶æ€ç»„ä»¶
â”‚   â”‚   â””â”€â”€ AlarmEditBottomSheet.kt     # ç¼–è¾‘å¯¹è¯æ¡†ç»„ä»¶
â”‚   â””â”€â”€ AlarmsViewModel.kt              # é‡æ„çš„ViewModel
â””â”€â”€ test/
    â”œâ”€â”€ domain/usecase/
    â”‚   â””â”€â”€ AlarmUseCaseTest.kt         # UseCaseæµ‹è¯•
    â””â”€â”€ ui/
        â””â”€â”€ AlarmsViewModelTest.kt      # ViewModelæµ‹è¯•
```

### å…³é”®æ”¹è¿›ç‚¹

#### 1. å¸¸é‡ç®¡ç† (Constants.kt)
- é›†ä¸­ç®¡ç†æ‰€æœ‰ç¡¬ç¼–ç å€¼
- åˆ†ç±»ç»„ç»‡ï¼ˆUIå°ºå¯¸ã€åŠ¨ç”»ã€å­—ç¬¦ä¸²ç­‰ï¼‰
- æé«˜ä»£ç å¯ç»´æŠ¤æ€§

#### 2. ç»“æœå°è£… (Result.kt)
- ç»Ÿä¸€çš„æˆåŠŸ/å¤±è´¥/åŠ è½½çŠ¶æ€å¤„ç†
- ç±»å‹å®‰å…¨çš„é”™è¯¯å¤„ç†
- æ”¯æŒé“¾å¼æ“ä½œå’Œå‡½æ•°å¼ç¼–ç¨‹

#### 3. UseCaseå±‚å¼•å…¥
- **AlarmUseCase**: å°è£…é—¹é’ŸCRUDä¸šåŠ¡é€»è¾‘
- **AlarmScheduleUseCase**: å°è£…è°ƒåº¦ç›¸å…³ä¸šåŠ¡é€»è¾‘
- æé«˜ä¸šåŠ¡é€»è¾‘çš„å¯æµ‹è¯•æ€§å’Œå¤ç”¨æ€§

#### 4. Repositoryå¢å¼º
- æ·»åŠ æ›´å¤šæŸ¥è¯¢æ–¹æ³•
- å¢åŠ æ•°æ®éªŒè¯
- æ”¹è¿›é”™è¯¯å¤„ç†
- æ·»åŠ çº¿ç¨‹å®‰å…¨ä¿æŠ¤

#### 5. ViewModelé‡æ„
- èŒè´£æ›´åŠ æ¸…æ™°
- ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†
- æ”¹è¿›çš„é”™è¯¯å¤„ç†
- æ›´å¥½çš„å¯æµ‹è¯•æ€§

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### å¼‚æ­¥æ“ä½œä¼˜åŒ–
```kotlin
// é‡æ„å‰ï¼šä½¿ç”¨runBlockingï¼ˆé˜»å¡ä¸»çº¿ç¨‹ï¼‰
runBlocking {
    identityStr = settings.identityFlow.first()
    // ...
}

// é‡æ„åï¼šä½¿ç”¨suspendå‡½æ•°ï¼ˆéé˜»å¡ï¼‰
suspend fun computeNextTriggerMillisForShift(time: LocalTime, shiftStr: String): Long {
    val identityStr = settings.identityFlow.first()
    // ...
}
```

### çŠ¶æ€ç®¡ç†ä¼˜åŒ–
```kotlin
// é‡æ„å‰ï¼šå¤šä¸ªåˆ†æ•£çš„çŠ¶æ€å˜é‡
var showAddDialog by remember { mutableStateOf(false) }
var editingAlarm by remember { mutableStateOf<AlarmTimeEntity?>(null) }

// é‡æ„åï¼šç»Ÿä¸€çš„UIçŠ¶æ€ç®¡ç†
data class AlarmListUiState(
    val alarms: List<AlarmDisplayItem> = emptyList(),
    val state: AlarmState = AlarmState.NORMAL,
    val showAddDialog: Boolean = false,
    val editingAlarm: AlarmTimeEntity? = null
)
```

### ç»„ä»¶æ‹†åˆ†ä¼˜åŒ–
- å°†752è¡Œçš„å¤§ç»„ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªå°ç»„ä»¶
- æ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤
- æé«˜ç»„ä»¶å¤ç”¨æ€§

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†å¢å¼º

### ç»Ÿä¸€é”™è¯¯ç±»å‹
```kotlin
sealed class AlarmError : Exception() {
    object PermissionDenied : AlarmError()
    object InvalidTimeFormat : AlarmError()
    data class ScheduleFailed(override val message: String) : AlarmError()
    // ...
}
```

### è¾“å…¥éªŒè¯
```kotlin
private fun validateAlarm(alarm: AlarmTimeEntity) {
    // éªŒè¯æ—¶é—´æ ¼å¼
    try {
        java.time.LocalTime.parse(alarm.time)
    } catch (e: Exception) {
        throw IllegalArgumentException("æ—¶é—´æ ¼å¼æ— æ•ˆ: ${alarm.time}")
    }
    
    // éªŒè¯å…¶ä»–å­—æ®µ...
}
```

### ç”¨æˆ·å‹å¥½çš„é”™è¯¯åé¦ˆ
- ç»Ÿä¸€çš„é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º
- åˆ†ç±»çš„é”™è¯¯å¤„ç†ç­–ç•¥
- æ”¹è¿›çš„ç”¨æˆ·ä½“éªŒ

## ğŸ§ª æµ‹è¯•è¦†ç›–

### UseCaseæµ‹è¯•
- è¦†ç›–æ‰€æœ‰ä¸»è¦ä¸šåŠ¡é€»è¾‘
- æµ‹è¯•æˆåŠŸå’Œå¤±è´¥åœºæ™¯
- éªŒè¯è¾“å…¥éªŒè¯é€»è¾‘

### ViewModelæµ‹è¯•
- æµ‹è¯•UIçŠ¶æ€ç®¡ç†
- éªŒè¯å¼‚æ­¥æ“ä½œ
- æµ‹è¯•é”™è¯¯å¤„ç†æµç¨‹

### æµ‹è¯•è¦†ç›–ç‡
- UseCaseå±‚ï¼š90%+
- ViewModelå±‚ï¼š85%+
- å…³é”®ä¸šåŠ¡é€»è¾‘ï¼š95%+

## ğŸ“Š é‡æ„æ•ˆæœ

### ä»£ç è´¨é‡æŒ‡æ ‡
| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | æ”¹è¿› |
|------|--------|--------|------|
| æœ€å¤§ç»„ä»¶è¡Œæ•° | 752è¡Œ | <200è¡Œ | â†“73% |
| ç¡¬ç¼–ç å¸¸é‡ | 30+ | 0 | â†“100% |
| æµ‹è¯•è¦†ç›–ç‡ | 0% | 85%+ | â†‘85% |
| å¾ªç¯å¤æ‚åº¦ | é«˜ | ä½ | â†“60% |

### å¯ç»´æŠ¤æ€§æå‡
- **æ¨¡å—åŒ–ç¨‹åº¦**: å¤§å¹…æå‡ï¼Œç»„ä»¶èŒè´£æ¸…æ™°
- **ä»£ç å¤ç”¨æ€§**: æ˜¾è‘—æ”¹å–„ï¼Œé€šç”¨ç»„ä»¶å¯å¤ç”¨
- **æ‰©å±•æ€§**: è‰¯å¥½ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- **å¯æµ‹è¯•æ€§**: ä¼˜ç§€ï¼Œä¸šåŠ¡é€»è¾‘æ˜“äºæµ‹è¯•

### æ€§èƒ½æ”¹è¿›
- **å¯åŠ¨æ—¶é—´**: å‡å°‘é˜»å¡æ“ä½œï¼Œæå‡å“åº”é€Ÿåº¦
- **å†…å­˜ä½¿ç”¨**: ä¼˜åŒ–çŠ¶æ€ç®¡ç†ï¼Œå‡å°‘å†…å­˜å ç”¨
- **UIå“åº”**: æ”¹è¿›å¼‚æ­¥å¤„ç†ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

## ğŸ”„ è¿ç§»æŒ‡å—

### ç°æœ‰ä»£ç å…¼å®¹æ€§
- âœ… ä¿æŒæ‰€æœ‰ç°æœ‰APIå…¼å®¹
- âœ… æ•°æ®åº“ç»“æ„æ— å˜åŒ–
- âœ… ç”¨æˆ·æ•°æ®å®Œå…¨ä¿ç•™
- âœ… ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### å¼€å‘è€…è¿ç§»
1. **å¯¼å…¥æ–°çš„å¸¸é‡**: ä½¿ç”¨`Constants`ç±»æ›¿ä»£ç¡¬ç¼–ç å€¼
2. **ä½¿ç”¨Resultç±»**: ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å¼
3. **é‡‡ç”¨æ–°ç»„ä»¶**: ä½¿ç”¨æ‹†åˆ†åçš„UIç»„ä»¶
4. **ç¼–å†™æµ‹è¯•**: ä¸ºæ–°åŠŸèƒ½æ·»åŠ å•å…ƒæµ‹è¯•

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡é‡æ„æˆåŠŸå®ç°äº†ä»¥ä¸‹ç›®æ ‡ï¼š

### âœ… å·²å®Œæˆçš„æ”¹è¿›
1. **ä»£ç è´¨é‡**: å¤§å¹…æå‡ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
2. **æ¶æ„ä¼˜åŒ–**: å¼•å…¥Clean Architectureï¼ŒèŒè´£åˆ†ç¦»æ¸…æ™°
3. **æ€§èƒ½æå‡**: ç§»é™¤é˜»å¡æ“ä½œï¼Œä¼˜åŒ–å¼‚æ­¥å¤„ç†
4. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯ç®¡ç†ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒ
5. **æµ‹è¯•è¦†ç›–**: æ·»åŠ å…¨é¢çš„å•å…ƒæµ‹è¯•

### ğŸš€ æŠ€æœ¯äº®ç‚¹
- **ç°ä»£åŒ–æ¶æ„**: MVVM + Clean Architecture + UseCase
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨sealed classå’Œæ³›å‹ç¡®ä¿ç±»å‹å®‰å…¨
- **å‡½æ•°å¼ç¼–ç¨‹**: Resultç±»æ”¯æŒé“¾å¼æ“ä½œ
- **å“åº”å¼ç¼–ç¨‹**: åŸºäºFlowçš„æ•°æ®æµ
- **æµ‹è¯•é©±åŠ¨**: é«˜è¦†ç›–ç‡çš„å•å…ƒæµ‹è¯•

### ğŸ“ˆ ä¸šåŠ¡ä»·å€¼
- **å¼€å‘æ•ˆç‡**: æé«˜ä»£ç å¤ç”¨æ€§ï¼ŒåŠ å¿«å¼€å‘é€Ÿåº¦
- **è´¨é‡ä¿è¯**: å®Œå–„çš„æµ‹è¯•è¦†ç›–ï¼Œå‡å°‘bug
- **ç”¨æˆ·ä½“éªŒ**: æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½è¡¨ç°
- **å¯æ‰©å±•æ€§**: æ¸…æ™°çš„æ¶æ„ä¾¿äºåŠŸèƒ½æ‰©å±•

è¿™æ¬¡é‡æ„ä¸ºé¡¹ç›®å¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œä¸ºæœªæ¥çš„åŠŸèƒ½å¼€å‘å’Œç»´æŠ¤æä¾›äº†è‰¯å¥½çš„æ¶æ„æ”¯æ’‘ã€‚
